<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:t="sap.ui.table"
    xmlns:u="sap.ui.unified">

    <t:TreeTable
        id="wbsTreeTable"
        rows="{
            path: 'viewData>/WBS',
            parameters: {arrayNames:['children']}
        }"
        selectionMode="Single"
        visibleRowCount="18"
        minAutoRowCount="15"
        enableColumnReordering="false"
        alternateRowColors="true"
        fixedColumnCount="3"
        class="sapUiSmallMarginTop sapUiSizeCompact">
        
        <t:extension>
            <OverflowToolbar>
                <Title text="WBS Structure" level="H2"/>
                <ToolbarSpacer/>
                <Button text="New Task" icon="sap-icon://add" type="Emphasized" press=".onAddNewTask" />
                <Button text="Delete" icon="sap-icon://delete" type="Reject" press=".onDeleteTask" />
            </OverflowToolbar>
        </t:extension>

        <t:columns>
    <t:Column width="22rem" autoResizable="true" filterProperty="TaskName">
        <t:label><Label text="Task Name" design="Bold"/></t:label>
        <t:template>
            <HBox alignItems="Center" width="100%">
                
                <core:Icon 
                    src="{= ${viewData>Type} === 'PHASE' ? 'sap-icon://folder-blank' : 'sap-icon://task' }" 
                    class="sapUiTinyMarginEnd" 
                    size="0.875rem" 
                    color="{= ${viewData>Type} === 'PHASE' ? '#346187' : '#5d6875' }"/>
                
                <Input 
                    value="{viewData>TaskName}" 
                    tooltip="{viewData>TaskName}"
                    class="small-font-input {= ${viewData>Type} === 'PHASE' ? 'font-bold' : '' }">
                    
                    <layoutData>
                        <FlexItemData growFactor="1" />
                    </layoutData>
                    
                </Input>
            </HBox>
        </t:template>
    </t:Column>

            <t:Column width="6.5rem" hAlign="Center">
                <t:label><Label text="Start" /></t:label>
                <t:template>
                    <DatePicker 
                        dateValue="{viewData>StartDate}" 
                        displayFormat="dd/MM/yy" 
                        class="small-date-picker" 
                        change=".onDateChange" />
                </t:template>
            </t:Column>

            <t:Column width="6.5rem" hAlign="Center">
                <t:label><Label text="End" /></t:label>
                <t:template>
                    <DatePicker 
                        dateValue="{viewData>EndDate}" 
                        displayFormat="dd/MM/yy" 
                        class="small-date-picker" 
                        change=".onDateChange" />
                </t:template>
            </t:Column>

            <t:Column width="{viewConfig>/totalWidth}" resizable="true">
                <t:label>
                    <HBox items="{viewConfig>/timeScale}" class="ganttHeader">
    <items>
        <VBox width="{viewConfig>width}" class="monthBlock">
    <Label text="{viewConfig>label}" textAlign="Center" width="100%" class="monthLabel"/>
    
    <HBox items="{viewConfig>days}" renderType="Bare">
    <items>
        <Text 
            text="{viewConfig>label}" 
            width="{viewConfig>width}" 
            textAlign="Center" 
            class="dayLabelSmall"/>
    </items>
</HBox>
</VBox>
    </items>
</HBox>
                </t:label>

                <t:template>
                    <HBox height="100%" width="100%" class="gantt-cell-container" alignItems="Center" renderType="Bare">
                        
                        <HBox width="{
                                path: 'viewData>StartDate',
                                formatter: '.calcMargin'
                            }" 
                            renderType="Bare" />

                        <HBox visible="{= ${viewData>Type} === 'PHASE' }" 
                              width="{
                                parts: [
                                    {path: 'viewData>StartDate'},
                                    {path: 'viewData>EndDate'}
                                ],
                                formatter: '.calcWidth'
                              }" 
                              class="gantt-bar-phase"
                              renderType="Bare">
                        </HBox>

                        <HBox visible="{= ${viewData>Type} !== 'PHASE' }" 
                              width="{
                                parts: [
                                    {path: 'viewData>StartDate'},
                                    {path: 'viewData>EndDate'}
                                ],
                                formatter: '.calcWidth'
                              }" 
                              class="gantt-bar-task"
                              renderType="Bare">
                        </HBox>

                    </HBox>
                </t:template>
            </t:Column>

        </t:columns>
    </t:TreeTable>

</core:FragmentDefinition>